# Telegram Tracking MVP (Node.js + Telegraf)

Minimal MVP to track Telegram join/reaction/comment/poll/share events and send postbacks with `click_id` to a CPA network.

## Quick start (VPS + PM2)

1. Install Node 20, Git, PM2.
2. Create Postgres DB (Neon/ElephantSQL or local).
3. `cp .env.example .env` and fill values.
4. `npm i`
5. `npm run migrate`
6. `pm2 start ecosystem.config.js && pm2 save`
7. Expose `PORT` via Nginx or Cloudflare Tunnel and set Telegram webhook:
   ```bash
   curl -X POST "https://api.telegram.org/bot$BOT_TOKEN/setWebhook"      -d "url=$BASE_URL/bot/webhook"      -d 'allowed_updates=["chat_member","chat_join_request","message_reaction","message_reaction_count","poll_answer","message","channel_post","pre_checkout_query","successful_payment"]'
   ```

## Endpoints
- `GET /click/:offerId` → creates token & redirects to `t.me/Bot?start=<token>`
- `GET /s/:shareToken` → counts unique share click & redirects
- `POST /postbacks/relay` → accept external postbacks (e.g., from advertiser's bot) and attribute by `user_id`

## Notes
- This is an MVP scaffold. Review and harden before production.

- # Telegram Gleam-like bot MVP

## Цель
Система трекинга действий пользователей Telegram (аналог gleam.io)
Рекламодатели создают задания: вступить в группу, подписаться на канал, нажать кнопку и т.д.
Бот отслеживает выполнение и возвращает результат через постбеки / вебхуки.

## Основные сущности
- Администратор
- Рекламодатель
- Пользователь (участник кампаний)

## Основные функции
1. Создание кампаний рекламодателями
2. Генерация реферальных / трекинг-ссылок
3. Проверка выполнения действий
4. Постбеки в систему HeyPay / Adspirin
5. Хранение статистики
6. Отчёты по действиям

## Технологический стек
Python + Aiogram + FastAPI + PostgreSQL


Бот в телеграм аналог gleam.io для владельцев телеграмм групп, ботов, миниаппов и каналов. Для отслеживания целевых действий и обратной связи в виде постбеков/вебхуков

Система представляет из себя телеграм бота, в который рекламодатели скидывают URL своего канала, группы, бота, миниапп
Выбирают целевое действие, количество целевых действий и производят оплату

В системе три основные сущности
Администратор бота
Хранить статистику
Выдавать ссылки
Проверять премиальность пользователя

Рекламодатель - размещает рекламные офферы в систему, оплачивает их и получает результат. Платит за Целевые Действия (ЦД): вступление в группу/канал; forward сообщений из группы/канала; реакция на сообщение; вступление/активация бота/миниапп; покупка звезд в ТГ; покупка/дарение ТГ премиум; иные действия в боте, по которым можно автоматизировать сбор постбеков.

Ты как разработчик и архитектор должен составить подробный список с ограничениями!

СРА сеть - сеть, где размещается ссылка данная ботом. В момент клика по ней, пользователем СРА сети, сеть присваивает uid кликайди, который в дальнейшем должен быть возвращен СРА сети в виде постбека. Бот фиксирует переход по ссылке (для статистики). Бот сохраняет связь user_id ↔ uid и выдаёт кнопку на Целевое Действие.


Пользователь жмёт, попадает на целевую страницу/бота/приложение.


Бот фиксирует событие Целевого действия и шлёт постбек в сеть о выполнении ЦД


Рекламодатель

/ads
	URL (что продвигаем) - вбиваем ссылку на канал/группу/сообщение/бота/миниапп
	Rate type(выбираем, за что хотим платить, за какие целевые действия ЦД)
вступить в группу
собрать лайки
запустить бота
Иные действия в боте
купить звезды
Указать стоимость ЦД (проверка на минимальное значение для того или иного типа ЦД). Каждый тип ЦД обладает минимальной стоимостью, ниже которой, запустить кампанию не получится. 
вступление в группу/канал; от 5 звезд обычный пользователь, от 10 звезд VIP
forward сообщений из группы/канала; от 2 звезды / 7 звезд
реакция на сообщение; от 1 звезда / 5 звезд

оставленный комментарий под записью; от 3 звезды / 10 звезд
покупка платного контента; от 30 звезд
вступление/активация бота/миниапп от 3 звезды / 10 звезд
Параметры должны быть настраиваемы администратором бота
Стоимость ЦД для премиум аккаунтов - поле для указания цены ЦД, которую рекламодатель готов заплатить, если ЦД выполняется премиальными аккаунтами ТГ
Лимит по ЦД  всего. Набор полей с указанием, сколько ЦД будет доступно для выполнения в выбранный временной промежуток
Временной таргетинг показа -  рекламодатель указывает в какие временные промежутки показывать оффер/рекламу (24/7, только будни, только будни рабочие дни, только выходные, ручной выбор часов и дней недели для показа)
Указать url группы/бота, где надо отслеживать выполнение ЦД.
Отдать ссылку, на которую надо наливать…
Оплатить размещение - переход на страницу оплаты звездами

После этого бот администратор получает подробную информацию о размещении. Ссылка и необходимые параметры настраиваются вручную менеджером СРА


/statistic
Раздел показывает статистику по офферам/рекламным кампаниям



## Как создать оффер через /ads
1. В Telegram напишите боту команду `/ads`.
2. Укажите целевой URL в формате `https://t.me/...`.
3. Выберите тип целевого действия и задайте ставки (не ниже минимальных из мастера).
4. Настройте лимиты, окно капа и временной таргетинг (пресеты или JSON).
5. Введите название оффера, подтвердите slug либо отправьте свой.
6. Проверьте карточку и подтвердите создание — бот пришлёт кликабельную ссылку вида `https://<BASE_URL_HOST>/click/<OFFER_ID>?uid={your_uid}`.
7. Замените `{your_uid}` на реальный `uid`/`click_id` из вашей CPA-сети перед раздачей ссылки.

