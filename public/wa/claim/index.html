<!doctype html><html lang="ru"><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Claim offer…</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:16px}.card{border:1px solid #ddd;border-radius:12px;padding:16px}.ok{color:#0a8}.err{color:#c00}</style>
</head><body>
<div class="card"><h3>Подтверждаем переход…</h3><div id="msg">Ждём Telegram…</div></div>
<script>
(async () => {
  try {
    const wa = window.Telegram?.WebApp; wa?.ready();
    const token = wa?.initDataUnsafe?.start_param || '';
    const initData = wa?.initData || '';
    const res = await fetch('/api/wa/claim', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ token, initData }) });
    const data = await res.json().catch(()=>({}));
    if (res.ok && data.ok) { document.getElementById('msg').innerHTML = '<b class="ok">✅ Готово! Связали клик с вашим аккаунтом.</b>'; setTimeout(()=>wa?.close(), 800); }
    else { document.getElementById('msg').innerHTML = '<b class="err">⚠️ Не удалось привязать токен.</b><br>'+(data.error||res.status); }
  } catch(e) { document.getElementById('msg').innerHTML = '<b class="err">Ошибка: '+e+'</b>'; }
})();
</script></body></html>
